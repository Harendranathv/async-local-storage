(function(a,b){"use strict";if(void 0!==a.window&&a.window===a&&void 0!==a.indexedDB){var c="async_local_storage",d="als_objects",e=1,f=null,g={};g.tail=new Future(function(a){a.accept()}),g.add=function(a){var b=g.tail,c=function(){return m().then(function(){var b=new Future(function(b){i(a,b)});return new Future(function(a){var c=a.accept.bind(a);b.done(c,c)})})};return g.tail=b.then(c,c)};var k,h=function(a){return a},i=function(a,b){var c=a.operation,e=a.transform||h,g=f.transaction([d],["get","forEach"].indexOf(c)>=0?"readonly":"readwrite"),i=g.objectStore(d),j=null,k=function(a){setTimeout(function(){b.resolve(e(a))},1)},l=function(a){setTimeout(function(){b.reject(a)},1)};switch(c){case"get":j=i.get(a.key);break;case"set":j=i.put(a.value,a.key);break;case"delete":j=i.delete(a.key);break;case"clear":j=i.clear();break;case"has":j=i.count(a.key);break;case"count":j=i.count();break;case"forEach":return j=i.openCursor(),j.onsuccess=function(b){var c=b.target.result;if(c)try{a.callback.call(a.scope||null,c.value,c.key),c.continue()}catch(d){l(d)}else k()},j.onerror=l,void 0}return j?(j.onsuccess=function(){k(j.result)},j.onerror=function(a){console.error(a),l(a)},void 0):(l(Error("IDB Request Failed")),void 0)},j=!1,l=new Future(function(a){k=a}),m=function(){if(j)return l;j=!0;var b=a.indexedDB.open(c,e);return b.onupgradeneeded=function(a){f=a.target.result,f.createObjectStore(d)},b.onsuccess=function(a){f=a.target.result,k.resolve(a)},b.onfailure=k.reject.bind(k),l},n=function(a){return{configurable:!0,enumerable:!1,writable:!1,value:a}};b.storage=Object.create(null,{has:n(function(a){return g.add({operation:"has",key:a,transform:function(a){return!!a}})}),set:n(function(a,b){return g.add({operation:"set",key:a,value:b})}),get:n(function(a){return g.add({operation:"get",key:a})}),"delete":n(function(a){return g.add({operation:"delete",key:a})}),clear:n(function(){return g.add({operation:"clear"})}),count:n(function(){return g.add({operation:"count"})}),forEach:n(function(a,c){return g.add({operation:"forEach",callback:function(c,d){a(c,d,b.storage)},scope:c})})})}})(this,this.navigator||{}),function(a,b){"use strict";var e,c={},d=b.MutationObserver||b.WebKitMutationObserver;if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))c.async=function(a,b){process.nextTick(function(){a.call(b)})};else if(d){var f=[],g=new d(function(){var a=f.slice();f=[],a.forEach(function(a){var b=a[0],c=a[1];b.call(c)})}),h=document.createElement("div");g.observe(h,{attributes:!0}),window.addEventListener("unload",function(){g.disconnect(),g=null}),c.async=function(a,b){f.push([a,b]),h.setAttribute("drainQueue","drainQueue")}}else c.async=function(a,b){setTimeout(function(){a.call(b)},1)};var i=function(a){return{enumerable:!0,configurable:!1,get:a}},j=function(a,b,c,d){return{enumerable:!!b,configurable:true,writable:true,value:a||function(){}}},k=function(a){return j(a,0,1,0)},l=function(a){return j(a,1)},m=function(a){return!!a&&"function"==typeof a.then&&2==a.then.length&&"function"==typeof a.done&&2==a.done.length},n=function(a){Error.call(this,a)};n.prototype=Object.create(Error.prototype);var o=function(){var a=[];return a.pump=function(b){c.async(function(){for(var c=a.length,d=0;c>d;)d++,a.shift()(b)})},a},p=function(a,b,d,e,f,g){var h=!1,j=function(){if(h)throw new n("Already Resolved")};this.resolve=function(a){return j(),m(a)?(a.done(this.resolve.bind(this),this.reject.bind(this)),void 0):(this.accept(a),h=!0,void 0)},this.accept=function(a){j(),h=!0,c.async(function(){g("accepted"),e(a),b.pump(a)})},this.reject=function(a){j(),h=!0,c.async(function(){g("rejected"),f(a),d.pump(a)})},this.cancel=function(){this.reject(Error("Cancel"))},this.timeout=function(){this.reject(Error("Timeout"))},Object.defineProperties(this,{isResolved:i(function(){return h})}),g("pending")},e=function(a){var d,e,b=new o,c=new o,f="pending";Object.defineProperties(this,{value:i(function(){return d}),error:i(function(){return e}),state:i(function(){return f}),_addAcceptCallback:k(function(a){b.push(a),"accepted"==f&&b.pump(d)}),_addRejectCallback:k(function(a){c.push(a),"rejected"==f&&c.pump(e)})}),a&&a(new p(this,b,c,function(a){d=a},function(a){e=a},function(a){f=a}))};e.prototype=Object.create(null,{then:l(function(a,b){var c=this,d=function(a,b){return function(){try{var c=a.apply(null,arguments);b.resolve(c)}catch(d){b.reject(d)}}};return new e(function(e){c._addAcceptCallback(d(a,e)),c._addRejectCallback(d(b,e))})}),done:l(function(a,b){return this._addAcceptCallback(a),this._addRejectCallback(b),this}),"catch":l(function(a){return this._addRejectCallback(a),this})}),e.async=c.async,a.Future=e}(this,"undefined"!=typeof window?window:{});
