(function(a,b){"use strict";var c,e,d=b.MutationObserver||b.WebKitMutationObserver;if("undefined"!=typeof process&&"[object process]"==={}.toString.call(process))c=function(a,b){process.nextTick(function(){a.call(b)})};else if(d){var f=[],g=new d(function(){var a=f.slice();f=[],a.forEach(function(a){var b=a[0],c=a[1];b.call(c)})}),h=document.createElement("div");g.observe(h,{attributes:!0}),window.addEventListener("unload",function(){g.disconnect(),g=null}),c=function(a,b){f.push([a,b]),h.setAttribute("drainQueue","drainQueue")}}else c=function(a,b){setTimeout(function(){a.call(b)},1)};var i=function(a){return{enumerable:!0,configurable:!1,get:a}},j=function(a,b,c,d){return{enumerable:!!b,configurable:true,writable:true,value:a||function(){}}},k=function(a){return j(a,0,1,0)},l=function(a){return j(a,1)},m=function(a){var b=!!a&&"function"==typeof a.then;return b},n=function(a){Error.call(this,a)};n.prototype=Object.create(Error.prototype);var o=function(){var a=[];return a.pump=function(b){c(function(){for(var c=a.length,d=0;c>d;)d++,a.shift()(b)})},a},p=function(a,b,d,e,f,g){var h=!1,k=this;this.resolve=function(a){if(!h){if(m(a))return"function"==typeof a.done?a.done(k.resolve,k.reject):a.then(k.resolve,k.reject),void 0;k.accept(a),h=!0}},this.accept=function(a){h||(h=!0,c(function(){g("accepted"),e(a),b.pump(a)}))},this.reject=function(a){h||(h=!0,c(function(){g("rejected"),f(a),d.pump(a)}))},this.cancel=function(){k.reject(Error("Cancel"))},this.timeout=function(){k.reject(Error("Timeout"))},Object.defineProperties(this,{isResolved:i(function(){return h})}),g("pending")},e=function(a){var d,e,b=new o,c=new o,f="pending";Object.defineProperties(this,{value:i(function(){return d}),error:i(function(){return e}),state:i(function(){return f}),_addAcceptCallback:k(function(a){b.push(a),"accepted"==f&&b.pump(d)}),_addRejectCallback:k(function(a){c.push(a),"rejected"==f&&c.pump(e)})}),a&&a(new p(this,b,c,function(a){d=a},function(a){e=a},function(a){f=a}))},q=function(a){return"function"==typeof a},r=function(a,b,c){return q(a)?function(){try{var c=a.apply(null,arguments);b.resolve(c)}catch(d){b.reject(d)}}:b[c].bind(b)},s=function(a,b,c){return q(a)&&c._addAcceptCallback(a),q(b)&&c._addRejectCallback(b),c};e.prototype=Object.create(null,{then:l(function(a,b){var c=this;return new e(function(d){s(r(a,d,"resolve"),r(b,d,"reject"),c)})}),done:l(function(a,b){return s(a,b,this)}),"catch":l(function(a){return s(null,a,this)})}),a.Future=e})(this,"undefined"!=typeof window?window:{}),function(a,b){"use strict";if(void 0!==a.window&&a.window===a&&void 0!==a.indexedDB){var c="async_local_storage",d="als_objects",e=1,f=null,g={};g.tail=new Future(function(a){a.accept()}),g.add=function(a){var b=g.tail,c=function(){return q().then(function(){var b=new Future(function(b){m(a,b)});return new Future(function(a){var c=a.accept.bind(a);b.done(c,c)})})};return g.tail=b.then(c,c)};var i,j,o,h=function(a){return a},k=function(){i=null,j=null},l=b.userAgent.match(/Firefox\/\d+(\.\d+)/)instanceof Array,m=function(a,b){var c=a.operation,e=a.transform||h;if(l&&i&&j)try{j.count()}catch(g){k()}i||(i=f.transaction([d],"readwrite"),j=i.objectStore(d),i.onabort=i.onerror=i.oncomplete=k);var m=null,n=function(a){b.resolve(e(a))},o=function(a){b.reject(a)};switch(c){case"get":m=j.get(a.key);break;case"set":m=j.put(a.value,a.key);break;case"delete":m=j.delete(a.key);break;case"clear":m=j.clear();break;case"has":m=j.count(a.key);break;case"count":m=j.count();break;case"forEach":return m=j.openCursor(),m.onsuccess=function(b){var c=b.target.result;if(c)try{a.callback.call(a.scope||null,c.value,c.key),c.continue()}catch(d){o(d)}else n()},m.onerror=o,void 0}return m?(m.onsuccess=function(){n(m.result)},m.onerror=function(a){console.error(a),o(a)},void 0):(o(Error("IDB Request Failed")),void 0)},n=!1,p=new Future(function(a){o=a}),q=function(){if(n)return p;n=!0;var b=a.indexedDB.open(c,e);return b.onupgradeneeded=function(a){f=a.target.result,f.createObjectStore(d)},b.onsuccess=function(a){f=a.target.result,o.resolve(a)},b.onfailure=o.reject.bind(o),p},r=function(a){return{configurable:!0,enumerable:!1,writable:!1,value:a}},s=b.alsPolyfillStorage=Object.create(null,{has:r(function(a){return g.add({operation:"has",key:a,transform:function(a){return!!a}})}),set:r(function(a,b){return g.add({operation:"set",key:a,value:b})}),get:r(function(a){return g.add({operation:"get",key:a})}),"delete":r(function(a){return g.add({operation:"delete",key:a})}),clear:r(function(){return g.add({operation:"clear"})}),count:r(function(){return g.add({operation:"count"})}),forEach:r(function(a,b){return g.add({operation:"forEach",callback:function(b,c){a(b,c,s)},scope:b})})})}}(this,this.navigator||{});
