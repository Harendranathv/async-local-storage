(function(a,b){"use strict";if(void 0!==a.window&&a.window===a&&void 0!==a.indexedDB){var c="async_local_storage",d="als_objects",e=1,f=function(a){try{console.error(a)}catch(b){}},g=null,h=[];h.add=function(a){return new Future(function(b){h.push({item:a,resolver:b}),j()})};var i=!1,j=function(){return i?(h.forEach(function(a,b){var e=h[b].resolver,f=h[b].item,i=f.operation,j=g.transaction([d],["get","forEach"].indexOf(i)>=0?"readonly":"readwrite"),k=j.objectStore(d),l=null;switch(i){case"get":l=k.get(f.key);break;case"set":l=k.put(f.value,f.key);break;case"delete":l=k.delete(f.key);break;case"forEach":break;case"clear":l=k.clear()}return l?(l.onsuccess=function(){e.resolve(l.result)},l.onerror=function(a){console.error(a),e.reject(a)},void 0):(resovler.reject(Error("IDB Request Failed")),void 0)}),h.length=0,void 0):(l(),void 0)},k=!1,l=function(){if(!k){k=!0;var b=a.indexedDB.open(c,e);b.onupgradeneeded=function(a){g=a.target.result,console.log("creating object store:",d),g.createObjectStore(d)},b.onsuccess=function(a){console.log("database opened successfully"),g=a.target.result,console.log(g),i=!0,j()},b.onfailure=f}},m=function(a){return{configurable:!0,enumerable:!1,writable:!1,value:a}};b.storage=Object.create(null,{has:m(function(a){return h.add({operation:"get",key:a})}),set:m(function(a,b){return h.add({operation:"set",key:a,value:b})}),get:m(function(a){return h.add({operation:"get",key:a})}),"delete":m(function(a){return h.add({operation:"delete",key:a})}),clear:m(function(){return h.add({operation:"clear"})}),forEach:m(function(a){return h.add({operation:"forEach",callback:function(c,d){a(c,d,b.storage)}})})}),console.log("storage end")}})(this,this.navigator||{});
